graph TD
    A[User Input: Story Request] --> B[Storytelling System]
    
    B --> C[Story Generator]
    C --> D[Generate Initial Story<br/>Age: 5-10<br/>Obstacle-focused, ~1200 words<br/>Lesson through actions]
    
    D --> E[Story Judge/Evaluator<br/>10 Criteria: Obstacle, Struggle, <br/>Lesson, Plot, Sensory, Age,<br/>Bedtime, Dialogue, Words, Magic]
    E --> F{Pass all criteria?}
    
    F -->|No| G[Generate Feedback]
    G --> H{Max Iterations<br/>Reached: 3}
    H -->|No| C
    H -->|Yes| I[Final Story]
    
    F -->|Yes| I
    
    I --> J[Display to User]
    J --> K{User Wants<br/>Changes?}
    
    K -->|Yes| L[User Feedback]
    L --> M[Story Regenerator<br/>with User Feedback]
    M --> N{Max User<br/>Revisions: 3}
    N -->|No| B
    N -->|Yes| O[End: Sweet Dreams!]
    
    K -->|No| O
    
    style A fill:#e1f5ff
    style I fill:#d4edda
    style O fill:#d4edda
    style E fill:#fff3cd
    style F fill:#fff3cd
    style C fill:#f8d7da
    style M fill:#f8d7da